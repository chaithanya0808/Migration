script to remove the party_name key from the case_party_details JSONB column once the migration is finished.
BEGIN;

DO $$ 
DECLARE
    batch_size INTEGER := 10000;
    rows_updated INTEGER;
BEGIN
    LOOP
        -- Batch removal of 'party_name' key
        UPDATE fcem_data.fc_case_party_relationship
        SET case_party_details = case_party_details - 'party_name'
        WHERE ctid IN (
            SELECT ctid
            FROM fcem_data.fc_case_party_relationship
            WHERE case_party_details ? 'party_name'
            LIMIT batch_size
        )
        RETURNING 1 INTO rows_updated;

        -- Exit when no more rows are updated
        EXIT WHEN rows_updated = 0;

        RAISE NOTICE '% rows cleaned in this batch.', rows_updated;
    END LOOP;

    RAISE NOTICE 'Cleanup of party_name from case_party_details completed successfully.';

END $$;



##Verify that party_name has been removed from case_party_details

 SELECT COUNT(*) AS remaining_party_name_count
FROM fcem_data.fc_case_party_relationship
WHERE case_party_details ? 'party_name';


##Verify that party_name exists in case_party_fc_profile:

SELECT COUNT(*) AS migrated_count
FROM fcem_data.fc_case_party_relationship
WHERE case_party_fc_profile ? 'party_name';

This should show the total number of rows where party_name was successfully migrated.
